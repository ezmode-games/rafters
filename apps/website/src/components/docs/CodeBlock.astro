---
const { code, language = 'tsx', filename, showLineNumbers = false } = Astro.props;
const lines = code.trim().split('\n');
---

<div class="bg-gray-900 rounded-md overflow-hidden my-6 border border-gray-800">
  {filename && (
    <div class="flex items-center justify-between px-4 py-2 bg-gray-800/50 border-b border-gray-800">
      <span class="font-mono text-sm text-gray-400">{filename}</span>
      <span class="font-mono text-xs font-medium uppercase tracking-wider text-gray-600 bg-gray-800 px-2 py-0.5 rounded">
        {language}
      </span>
    </div>
  )}
  <div class="relative p-4 group">
    <pre class="m-0 bg-transparent p-0"><code class={`language-${language} font-mono text-sm leading-relaxed text-gray-200`}>{lines.map((line, i) => (
      <span class="block">{showLineNumbers && <span class="inline-block w-10 text-right pr-4 text-gray-600 select-none">{i + 1}</span>}{line}</span>
    ))}</code></pre>
    <button
      class="absolute top-3 right-3 p-2 bg-gray-800 border border-gray-700 rounded text-gray-500 hover:text-white hover:border-gray-500 transition-colors cursor-pointer opacity-0 group-hover:opacity-100 code-copy-btn"
      data-code={code}
      aria-label="Copy code"
    >
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
    </button>
  </div>
</div>

<script>
  document.querySelectorAll('.code-copy-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
      const code = btn.getAttribute('data-code');
      if (code) {
        await navigator.clipboard.writeText(code);
        btn.classList.add('text-green-500', 'border-green-500');
        btn.classList.remove('text-gray-500', 'border-gray-700');
        setTimeout(() => {
          btn.classList.remove('text-green-500', 'border-green-500');
          btn.classList.add('text-gray-500', 'border-gray-700');
        }, 2000);
      }
    });
  });
</script>
