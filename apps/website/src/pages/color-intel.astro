---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="Color Intelligence Viewer" description="Explore comprehensive color intelligence for any OKLCH color">
  <style>
    .container {
      min-height: 100vh;
      background-color: #f9fafb;
      padding: 2rem 1rem;
    }
    .inner {
      max-width: 80rem;
      margin: 0 auto;
    }
    .card {
      background: white;
      border-radius: 0.5rem;
      padding: 1.5rem;
      margin-bottom: 2rem;
      border: 1px solid #e5e7eb;
    }
    .input-group {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }
    .input-wrapper {
      flex: 1;
    }
    .input-label {
      display: block;
      font-size: 0.75rem;
      color: #6b7280;
      margin-bottom: 0.25rem;
    }
    .input {
      width: 100%;
      padding: 0.5rem 0.75rem;
      border: 1px solid #d1d5db;
      border-radius: 0.375rem;
      font-size: 1rem;
    }
    .btn {
      padding: 0.5rem 1.5rem;
      background-color: #111827;
      color: white;
      border: none;
      border-radius: 0.375rem;
      cursor: pointer;
      font-size: 1rem;
    }
    .btn:hover {
      background-color: #1f2937;
    }
    .hidden {
      display: none;
    }
    .spinner {
      width: 2rem;
      height: 2rem;
      border: 2px solid #d1d5db;
      border-top-color: #111827;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .color-preview-large {
      width: 8rem;
      height: 8rem;
      border-radius: 0.5rem;
      border: 2px solid #d1d5db;
    }
    .flex-row {
      display: flex;
      align-items: center;
      gap: 1.5rem;
    }
    .space-y-4 > * + * {
      margin-top: 1rem;
    }
    .harmony-container {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    .color-chip {
      width: 4rem;
      height: 4rem;
      border-radius: 0.25rem;
      border: 1px solid #d1d5db;
      cursor: pointer;
    }
    .scale-container {
      display: flex;
      gap: 0.5rem;
    }
    .scale-chip {
      flex: 1;
      height: 6rem;
      border-radius: 0.25rem;
      border: 1px solid #d1d5db;
      position: relative;
    }
    .scale-label {
      position: absolute;
      bottom: 0.25rem;
      left: 0.25rem;
      font-size: 0.75rem;
      font-family: monospace;
      background: white;
      padding: 0.125rem 0.25rem;
      border-radius: 0.125rem;
    }
    .pre-block {
      font-family: monospace;
      font-size: 0.75rem;
      background-color: #f3f4f6;
      padding: 1rem;
      border-radius: 0.375rem;
      overflow-x: auto;
      white-space: pre-wrap;
    }
    .grid-2 {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }
    .section-title {
      font-size: 1.5rem;
      font-family: monospace;
      font-weight: 600;
      margin-bottom: 1rem;
    }
    .label {
      font-size: 0.875rem;
      font-weight: 500;
      color: #6b7280;
      margin-bottom: 0.25rem;
    }
    .value {
      color: #111827;
    }
    .text-lg {
      font-size: 1.125rem;
    }
    .text-xl {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.75rem;
    }
    .error-box {
      background-color: #fef2f2;
      padding: 1.5rem;
      border-radius: 0.5rem;
      border: 1px solid #fecaca;
      color: #991b1b;
    }
    details {
      background: white;
      border-radius: 0.5rem;
      padding: 1.5rem;
      border: 1px solid #e5e7eb;
      cursor: pointer;
    }
    summary {
      font-size: 1.25rem;
      font-family: monospace;
      font-weight: 600;
    }
  </style>

  <div class="container">
    <div class="inner">
      <h1 style="font-size: 2.25rem; font-family: monospace; font-weight: 600; margin-bottom: 0.5rem;">
        Color Intelligence Viewer
      </h1>
      <p style="color: #6b7280; margin-bottom: 2rem;">
        Enter an OKLCH color to see complete AI-powered color intelligence
      </p>

      <!-- Color Input -->
      <div class="card">
        <label style="display: block; font-size: 0.875rem; font-weight: 500; margin-bottom: 0.5rem;">
          OKLCH Color
        </label>
        <div class="input-group">
          <div class="input-wrapper">
            <label class="input-label">Lightness (0-1)</label>
            <input type="number" id="lightness" min="0" max="1" step="0.01" value="0.45" class="input" />
          </div>
          <div class="input-wrapper">
            <label class="input-label">Chroma (0-0.4)</label>
            <input type="number" id="chroma" min="0" max="0.4" step="0.01" value="0.03" class="input" />
          </div>
          <div class="input-wrapper">
            <label class="input-label">Hue (0-360)</label>
            <input type="number" id="hue" min="0" max="360" step="1" value="257" class="input" />
          </div>
        </div>
        <button id="analyzeBtn" class="btn">Analyze Color</button>
      </div>

      <!-- Loading State -->
      <div id="loading" class="card hidden" style="text-align: center;">
        <div class="spinner"></div>
        <p style="color: #6b7280;">Analyzing color...</p>
      </div>

      <!-- Error State -->
      <div id="error" class="error-box hidden">
        <p id="errorMessage"></p>
      </div>

      <!-- Results -->
      <div id="results" class="hidden">
        <!-- Color Preview and Scale (Two Columns) -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
          <div class="card" style="margin-bottom: 0;">
            <h2 class="section-title">Color Preview</h2>
            <div class="flex-row">
              <div id="colorPreview" class="color-preview-large"></div>
              <div>
                <p class="label">Color Name</p>
                <p id="colorName" class="text-xl"></p>
                <p class="label">OKLCH Value</p>
                <p id="oklchValue" style="font-family: monospace; font-size: 0.875rem;"></p>
              </div>
            </div>
          </div>

          <div class="card" style="margin-bottom: 0;">
            <h2 class="section-title">Color Scale</h2>
            <div id="scale" class="scale-container"></div>
          </div>
        </div>

        <!-- Intelligence -->
        <div class="card">
          <h2 class="section-title">AI Intelligence</h2>
          <div class="space-y-4">
            <div>
              <p class="label">Suggested Name</p>
              <p id="suggestedName" class="text-lg value"></p>
            </div>
            <div>
              <p class="label">Reasoning</p>
              <p id="reasoning" class="value"></p>
            </div>
            <div>
              <p class="label">Emotional Impact</p>
              <p id="emotionalImpact" class="value"></p>
            </div>
            <div>
              <p class="label">Cultural Context</p>
              <p id="culturalContext" class="value"></p>
            </div>
            <div>
              <p class="label">Usage Guidance</p>
              <p id="usageGuidance" class="value"></p>
            </div>
            <div>
              <p class="label">Accessibility Notes</p>
              <p id="accessibilityNotes" class="value"></p>
            </div>
          </div>
        </div>

        <!-- Harmonies and Semantic Suggestions (Two Columns) -->
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">
          <div class="card" style="margin-bottom: 0;">
            <h2 class="section-title">Color Harmonies</h2>
            <div id="harmonies" class="space-y-4"></div>
          </div>

          <div class="card" style="margin-bottom: 0;">
            <h2 class="section-title">Semantic Color Suggestions</h2>
            <div id="semanticSuggestions" class="space-y-4"></div>
          </div>
        </div>

        <!-- Accessibility -->
        <div class="card">
          <h2 class="section-title">Accessibility</h2>
          <pre id="accessibility" class="pre-block"></pre>
        </div>

        <!-- Analysis -->
        <div class="card">
          <h2 class="section-title">Analysis</h2>
          <div id="analysis" class="grid-2"></div>
        </div>

        <!-- Weights -->
        <div class="card">
          <h2 class="section-title">Perceptual Weights</h2>
          <div id="weights" class="space-y-4"></div>
        </div>

        <!-- Raw JSON -->
        <details>
          <summary>Raw JSON Response</summary>
          <pre id="rawJson" class="pre-block" style="margin-top: 1rem;"></pre>
        </details>
      </div>
    </div>
  </div>

  <script>
    const analyzeBtn = document.getElementById('analyzeBtn');
    const loading = document.getElementById('loading');
    const error = document.getElementById('error');
    const results = document.getElementById('results');

    analyzeBtn?.addEventListener('click', async () => {
      const l = parseFloat((document.getElementById('lightness') as HTMLInputElement).value);
      const c = parseFloat((document.getElementById('chroma') as HTMLInputElement).value);
      const h = parseFloat((document.getElementById('hue') as HTMLInputElement).value);

      error?.classList.add('hidden');
      results?.classList.add('hidden');
      loading?.classList.remove('hidden');

      try {
        const response = await fetch('https://rafters.realhandy.tech/api/color-intel', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ oklch: { l, c, h } })
        });

        if (!response.ok) {
          throw new Error(`API error: ${response.status}`);
        }

        const data = await response.json();

        loading?.classList.add('hidden');
        results?.classList.remove('hidden');

        // Update color preview
        const colorPreview = document.getElementById('colorPreview');
        if (colorPreview) {
          colorPreview.style.backgroundColor = `oklch(${l} ${c} ${h})`;
        }

        // Update basic info
        const colorName = document.getElementById('colorName');
        if (colorName) colorName.textContent = data.name || 'Unknown';

        const oklchValue = document.getElementById('oklchValue');
        if (oklchValue) oklchValue.textContent = `oklch(${l} ${c} ${h})`;

        // Update intelligence
        if (data.intelligence) {
          const suggestedName = document.getElementById('suggestedName');
          if (suggestedName) suggestedName.textContent = data.intelligence.suggestedName || '';

          const reasoning = document.getElementById('reasoning');
          if (reasoning) reasoning.textContent = data.intelligence.reasoning || '';

          const emotionalImpact = document.getElementById('emotionalImpact');
          if (emotionalImpact) emotionalImpact.textContent = data.intelligence.emotionalImpact || '';

          const culturalContext = document.getElementById('culturalContext');
          if (culturalContext) culturalContext.textContent = data.intelligence.culturalContext || '';

          const usageGuidance = document.getElementById('usageGuidance');
          if (usageGuidance) usageGuidance.textContent = data.intelligence.usageGuidance || '';

          const accessibilityNotes = document.getElementById('accessibilityNotes');
          if (accessibilityNotes) accessibilityNotes.textContent = data.intelligence.accessibilityNotes || '';
        }

        // Update harmonies
        if (data.harmonies) {
          const harmoniesDiv = document.getElementById('harmonies');
          if (harmoniesDiv) {
            harmoniesDiv.innerHTML = '';

            Object.entries(data.harmonies).forEach(([name, value]: [string, any]) => {
              const harmonyDiv = document.createElement('div');

              const title = document.createElement('p');
              title.className = 'label';
              title.style.textTransform = 'capitalize';
              title.textContent = name;
              harmonyDiv.appendChild(title);

              const colors = Array.isArray(value) ? value : [value];
              const colorContainer = document.createElement('div');
              colorContainer.style.display = 'flex';
              colorContainer.style.gap = '0.5rem';
              colorContainer.style.flexWrap = 'wrap';

              colors.forEach((color: any) => {
                const colorBox = document.createElement('div');
                colorBox.style.width = '4rem';
                colorBox.style.height = '4rem';
                colorBox.style.borderRadius = '0.25rem';
                colorBox.style.border = '1px solid #d1d5db';
                colorBox.style.cursor = 'pointer';
                colorBox.style.backgroundColor = `oklch(${color.l} ${color.c} ${color.h})`;
                colorBox.title = `oklch(${color.l} ${color.c} ${color.h})`;
                colorContainer.appendChild(colorBox);
              });

              harmonyDiv.appendChild(colorContainer);
              harmoniesDiv.appendChild(harmonyDiv);
            });
          }
        }

        // Update scale
        if (data.scale) {
          const scaleDiv = document.getElementById('scale');
          if (scaleDiv) {
            scaleDiv.innerHTML = '';
            const scaleNames = ['50', '100', '200', '300', '400', '500', '600', '700', '800', '900', '950'];
            data.scale.forEach((color: any, index: number) => {
              const colorBox = document.createElement('div');
              colorBox.className = 'scale-chip';
              colorBox.style.backgroundColor = `oklch(${color.l} ${color.c} ${color.h})`;

              const label = document.createElement('span');
              label.className = 'scale-label';
              label.textContent = scaleNames[index];
              colorBox.appendChild(label);

              scaleDiv.appendChild(colorBox);
            });
          }
        }

        // Update accessibility with visual contrast pairs
        if (data.accessibility) {
          const accessibilityDiv = document.getElementById('accessibility');
          if (accessibilityDiv) {
            accessibilityDiv.innerHTML = '';

            // Helper to create contrast pair visualization
            const createContrastPair = (pair: number[], scale: any[], label: string) => {
              const container = document.createElement('div');
              container.style.display = 'inline-block';
              container.style.marginRight = '1rem';
              container.style.marginBottom = '1rem';

              const bg = scale[pair[0]];
              const fg = scale[pair[1]];

              const chip = document.createElement('div');
              chip.style.width = '120px';
              chip.style.height = '60px';
              chip.style.backgroundColor = `oklch(${bg.l} ${bg.c} ${bg.h})`;
              chip.style.color = `oklch(${fg.l} ${fg.c} ${fg.h})`;
              chip.style.border = '1px solid #d1d5db';
              chip.style.borderRadius = '0.25rem';
              chip.style.display = 'flex';
              chip.style.alignItems = 'center';
              chip.style.justifyContent = 'center';
              chip.style.fontWeight = '600';
              chip.style.fontSize = '0.875rem';
              chip.textContent = label;
              chip.title = `BG: ${pair[0]}, FG: ${pair[1]}`;

              container.appendChild(chip);
              return container;
            };

            if (data.accessibility.wcagAA) {
              const aaTitle = document.createElement('p');
              aaTitle.className = 'label';
              aaTitle.textContent = 'WCAG AA Contrast Pairs';
              aaTitle.style.marginTop = '0';
              accessibilityDiv.appendChild(aaTitle);

              if (data.accessibility.wcagAA.normal) {
                const normalLabel = document.createElement('p');
                normalLabel.style.fontSize = '0.75rem';
                normalLabel.style.color = '#6b7280';
                normalLabel.style.marginTop = '0.5rem';
                normalLabel.style.marginBottom = '0.5rem';
                normalLabel.textContent = 'Normal Text (4.5:1)';
                accessibilityDiv.appendChild(normalLabel);

                const normalContainer = document.createElement('div');
                data.accessibility.wcagAA.normal.forEach((pair: number[]) => {
                  normalContainer.appendChild(createContrastPair(pair, data.scale, 'Aa'));
                });
                accessibilityDiv.appendChild(normalContainer);
              }

              if (data.accessibility.wcagAA.large) {
                const largeLabel = document.createElement('p');
                largeLabel.style.fontSize = '0.75rem';
                largeLabel.style.color = '#6b7280';
                largeLabel.style.marginTop = '1rem';
                largeLabel.style.marginBottom = '0.5rem';
                largeLabel.textContent = 'Large Text (3:1)';
                accessibilityDiv.appendChild(largeLabel);

                const largeContainer = document.createElement('div');
                data.accessibility.wcagAA.large.forEach((pair: number[]) => {
                  largeContainer.appendChild(createContrastPair(pair, data.scale, 'Aa'));
                });
                accessibilityDiv.appendChild(largeContainer);
              }
            }

            if (data.accessibility.wcagAAA) {
              const aaaTitle = document.createElement('p');
              aaaTitle.className = 'label';
              aaaTitle.style.marginTop = '1.5rem';
              aaaTitle.textContent = 'WCAG AAA Contrast Pairs';
              accessibilityDiv.appendChild(aaaTitle);

              if (data.accessibility.wcagAAA.normal) {
                const normalLabel = document.createElement('p');
                normalLabel.style.fontSize = '0.75rem';
                normalLabel.style.color = '#6b7280';
                normalLabel.style.marginTop = '0.5rem';
                normalLabel.style.marginBottom = '0.5rem';
                normalLabel.textContent = 'Normal Text (7:1)';
                accessibilityDiv.appendChild(normalLabel);

                const normalContainer = document.createElement('div');
                data.accessibility.wcagAAA.normal.forEach((pair: number[]) => {
                  normalContainer.appendChild(createContrastPair(pair, data.scale, 'Aa'));
                });
                accessibilityDiv.appendChild(normalContainer);
              }

              if (data.accessibility.wcagAAA.large) {
                const largeLabel = document.createElement('p');
                largeLabel.style.fontSize = '0.75rem';
                largeLabel.style.color = '#6b7280';
                largeLabel.style.marginTop = '1rem';
                largeLabel.style.marginBottom = '0.5rem';
                largeLabel.textContent = 'Large Text (4.5:1)';
                accessibilityDiv.appendChild(largeLabel);

                const largeContainer = document.createElement('div');
                data.accessibility.wcagAAA.large.forEach((pair: number[]) => {
                  largeContainer.appendChild(createContrastPair(pair, data.scale, 'Aa'));
                });
                accessibilityDiv.appendChild(largeContainer);
              }
            }

            // On White/Black
            if (data.accessibility.onWhite || data.accessibility.onBlack) {
              const specialTitle = document.createElement('p');
              specialTitle.className = 'label';
              specialTitle.style.marginTop = '1.5rem';
              specialTitle.textContent = 'Text on White/Black Backgrounds';
              accessibilityDiv.appendChild(specialTitle);

              if (data.accessibility.onWhite?.aa) {
                const whiteLabel = document.createElement('p');
                whiteLabel.style.fontSize = '0.75rem';
                whiteLabel.style.color = '#6b7280';
                whiteLabel.style.marginTop = '0.5rem';
                whiteLabel.style.marginBottom = '0.5rem';
                whiteLabel.textContent = 'On White (AA)';
                accessibilityDiv.appendChild(whiteLabel);

                const whiteContainer = document.createElement('div');
                data.accessibility.onWhite.aa.forEach((position: number) => {
                  const color = data.scale[position];
                  const chip = document.createElement('div');
                  chip.style.width = '80px';
                  chip.style.height = '60px';
                  chip.style.backgroundColor = 'white';
                  chip.style.color = `oklch(${color.l} ${color.c} ${color.h})`;
                  chip.style.border = '1px solid #d1d5db';
                  chip.style.borderRadius = '0.25rem';
                  chip.style.display = 'inline-flex';
                  chip.style.alignItems = 'center';
                  chip.style.justifyContent = 'center';
                  chip.style.fontWeight = '600';
                  chip.style.fontSize = '0.875rem';
                  chip.style.marginRight = '0.5rem';
                  chip.style.marginBottom = '0.5rem';
                  chip.textContent = `${position}`;
                  chip.title = `Position ${position} on white`;
                  whiteContainer.appendChild(chip);
                });
                accessibilityDiv.appendChild(whiteContainer);
              }

              if (data.accessibility.onBlack) {
                const blackLabel = document.createElement('p');
                blackLabel.style.fontSize = '0.75rem';
                blackLabel.style.color = '#6b7280';
                blackLabel.style.marginTop = '1rem';
                blackLabel.style.marginBottom = '0.5rem';
                blackLabel.textContent = 'On Black';
                accessibilityDiv.appendChild(blackLabel);

                const blackContainer = document.createElement('div');

                // Combine AA and AAA into one section
                const allPositions = [
                  ...(data.accessibility.onBlack.aa || []),
                  ...(data.accessibility.onBlack.aaa || [])
                ];

                // Remove duplicates and sort
                const uniquePositions = [...new Set(allPositions)].sort((a, b) => a - b);

                uniquePositions.forEach((position: number) => {
                  const color = data.scale[position];
                  if (!color) {
                    console.error(`Missing scale position for ${position} (index ${position})`);
                    return;
                  }

                  const isAAA = data.accessibility.onBlack.aaa?.includes(position);

                  const chip = document.createElement('div');
                  chip.style.width = '80px';
                  chip.style.height = '60px';
                  chip.style.backgroundColor = 'black';
                  chip.style.color = `oklch(${color.l} ${color.c} ${color.h})`;
                  chip.style.border = '1px solid #d1d5db';
                  chip.style.borderRadius = '0.25rem';
                  chip.style.display = 'inline-flex';
                  chip.style.alignItems = 'center';
                  chip.style.justifyContent = 'center';
                  chip.style.fontWeight = '600';
                  chip.style.fontSize = '0.875rem';
                  chip.style.marginRight = '0.5rem';
                  chip.style.marginBottom = '0.5rem';
                  chip.textContent = `${position}`;
                  chip.title = `Position ${position} on black (${isAAA ? 'AAA' : 'AA'})`;
                  blackContainer.appendChild(chip);
                });
                accessibilityDiv.appendChild(blackContainer);
              }
            }
          }
        }

        // Update analysis
        if (data.analysis) {
          const analysisDiv = document.getElementById('analysis');
          if (analysisDiv) {
            analysisDiv.innerHTML = '';
            Object.entries(data.analysis).forEach(([key, value]) => {
              const item = document.createElement('div');
              const keyLabel = document.createElement('p');
              keyLabel.className = 'label';
              keyLabel.style.textTransform = 'capitalize';
              keyLabel.textContent = key.replace(/([A-Z])/g, ' $1');
              const valueText = document.createElement('p');
              valueText.className = 'value';
              valueText.textContent = String(value);
              item.appendChild(keyLabel);
              item.appendChild(valueText);
              analysisDiv.appendChild(item);
            });
          }
        }

        // Update weights
        const weightsDiv = document.getElementById('weights');
        if (weightsDiv) {
          weightsDiv.innerHTML = '';

          if (data.atmosphericWeight) {
            const atmo = document.createElement('div');
            const title = document.createElement('p');
            title.className = 'label';
            title.textContent = 'Atmospheric Weight';
            const pre = document.createElement('pre');
            pre.className = 'pre-block';
            pre.style.marginTop = '0.25rem';
            pre.textContent = JSON.stringify(data.atmosphericWeight, null, 2);
            atmo.appendChild(title);
            atmo.appendChild(pre);
            weightsDiv.appendChild(atmo);
          }

          if (data.perceptualWeight) {
            const percep = document.createElement('div');
            const title = document.createElement('p');
            title.className = 'label';
            title.textContent = 'Perceptual Weight';
            const pre = document.createElement('pre');
            pre.className = 'pre-block';
            pre.style.marginTop = '0.25rem';
            pre.textContent = JSON.stringify(data.perceptualWeight, null, 2);
            percep.appendChild(title);
            percep.appendChild(pre);
            weightsDiv.appendChild(percep);
          }
        }

        // Update semantic suggestions
        if (data.semanticSuggestions) {
          const semanticDiv = document.getElementById('semanticSuggestions');
          if (semanticDiv) {
            semanticDiv.innerHTML = '';
            Object.entries(data.semanticSuggestions).forEach(([name, colors]: [string, any]) => {
              const suggestionDiv = document.createElement('div');

              const title = document.createElement('p');
              title.className = 'label';
              title.style.textTransform = 'capitalize';
              title.textContent = name;
              suggestionDiv.appendChild(title);

              const colorContainer = document.createElement('div');
              colorContainer.style.display = 'flex';
              colorContainer.style.gap = '0.5rem';
              colorContainer.style.flexWrap = 'wrap';

              colors.forEach((color: any) => {
                const colorBox = document.createElement('div');
                colorBox.style.width = '4rem';
                colorBox.style.height = '4rem';
                colorBox.style.borderRadius = '0.25rem';
                colorBox.style.border = '1px solid #d1d5db';
                colorBox.style.cursor = 'pointer';
                colorBox.style.backgroundColor = `oklch(${color.l} ${color.c} ${color.h})`;
                colorBox.title = `oklch(${color.l} ${color.c} ${color.h})`;
                colorContainer.appendChild(colorBox);
              });

              suggestionDiv.appendChild(colorContainer);
              semanticDiv.appendChild(suggestionDiv);
            });
          }
        }

        // Update raw JSON
        const rawJson = document.getElementById('rawJson');
        if (rawJson) {
          rawJson.textContent = JSON.stringify(data, null, 2);
        }

      } catch (err) {
        loading?.classList.add('hidden');
        error?.classList.remove('hidden');
        const errorMessage = document.getElementById('errorMessage');
        if (errorMessage) {
          errorMessage.textContent = err instanceof Error ? err.message : 'Failed to analyze color';
        }
      }
    });

    // Trigger initial analysis
    analyzeBtn?.click();
  </script>
</BaseLayout>
