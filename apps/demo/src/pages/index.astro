---
/**
 * Component Gallery Index
 * Shows all components grouped by category
 */

import GridOverlay from '../components/blueprint/GridOverlay.astro';
import CategorySection from '../components/gallery/CategorySection.astro';
import GalleryLayout from '../layouts/GalleryLayout.astro';
import { groupByCategory, loadAllComponents } from '../lib/component-registry';
import { CATEGORIES, type ComponentCategory } from '../lib/types';

// Load all components at build time
const components = loadAllComponents();
const grouped = groupByCategory(components);

// Sort categories by order
const sortedCategories = [...grouped.entries()].sort(
  ([a], [b]) => CATEGORIES[a].order - CATEGORIES[b].order,
);

// Stats for header
const totalComponents = components.length;
const avgCognitiveLoad =
  components.reduce((sum, c) => sum + c.intelligence.cognitiveLoad.score, 0) / totalComponents;
---

<GalleryLayout title="Component Gallery" description="Rafters UI Component Library - Blueprint Contact Sheets">
  <div class="flex flex-col gap-8">
    <!-- Hero Section -->
    <header class="relative p-8 bg-muted/30 border border-border overflow-hidden">
      <GridOverlay density="coarse" />
      <div class="relative z-10 max-w-2xl">
        <h1 class="font-mono text-3xl font-medium tracking-widest uppercase text-foreground m-0 mb-4">
          Component Gallery
        </h1>
        <p class="text-base leading-relaxed text-muted-foreground m-0 mb-8">
          Explore the Rafters UI component library with detailed intelligence metadata,
          cognitive load ratings, and usage patterns.
        </p>
        <div class="flex gap-8">
          <div class="flex flex-col gap-1">
            <span class="font-mono text-2xl font-medium text-primary">{totalComponents}</span>
            <span class="font-mono text-xs tracking-widest uppercase text-muted-foreground">Components</span>
          </div>
          <div class="flex flex-col gap-1">
            <span class="font-mono text-2xl font-medium text-primary">{avgCognitiveLoad.toFixed(1)}</span>
            <span class="font-mono text-xs tracking-widest uppercase text-muted-foreground">Avg. Cognitive Load</span>
          </div>
          <div class="flex flex-col gap-1">
            <span class="font-mono text-2xl font-medium text-primary">{sortedCategories.length}</span>
            <span class="font-mono text-xs tracking-widest uppercase text-muted-foreground">Categories</span>
          </div>
        </div>
      </div>
    </header>

    <!-- Quick Nav -->
    <nav class="flex flex-wrap gap-2 p-4 bg-muted/30 border border-border" aria-label="Component categories">
      {sortedCategories.map(([category]) => (
        <a
          href={`#${category}`}
          class="font-mono text-xs tracking-wider uppercase text-muted-foreground no-underline px-4 py-2 border border-border transition-colors hover:text-foreground hover:border-primary hover:bg-primary/5"
        >
          {CATEGORIES[category].label}
        </a>
      ))}
    </nav>

    <!-- Component Categories -->
    <div class="flex flex-col">
      {sortedCategories.map(([category, categoryComponents]) => (
        <CategorySection category={category} components={categoryComponents} />
      ))}
    </div>
  </div>
</GalleryLayout>
