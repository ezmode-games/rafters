---
/**
 * Docs Index - Overview of all documentation sections
 *
 * Uses Rafters components:
 * - Container: main landmark with size constraint
 * - Grid: linear preset for equal-priority cards
 * - Card: interactive cards for doc links
 * - Typography: H1, H2, Lead, Muted for hierarchy
 * - Badge: section indicators
 * - Separator: visual division
 */

import { getCollection } from 'astro:content';
import { Badge } from '@rafters/ui/components/ui/badge';
import { Card, CardDescription, CardHeader, CardTitle } from '@rafters/ui/components/ui/card';
import { Container } from '@rafters/ui/components/ui/container';
import { Grid } from '@rafters/ui/components/ui/grid';
import { Separator } from '@rafters/ui/components/ui/separator';
import { H1, H2, Lead, Muted } from '@rafters/ui/components/ui/typography';
import BaseLayout from '../../layouts/BaseLayout.astro';

const allDocs = await getCollection('docs', ({ data }) => !data.draft);

// Group by section
const sections = {
  concepts: {
    label: 'Concepts',
    description: 'Understanding the Design Intelligence Protocol',
    docs: [] as typeof allDocs,
  },
  tokens: {
    label: 'Tokens',
    description: 'The dependency-aware token system',
    docs: [] as typeof allDocs,
  },
  components: {
    label: 'Components',
    description: 'UI building blocks with embedded intelligence',
    docs: [] as typeof allDocs,
  },
  patterns: {
    label: 'Patterns',
    description: 'Solving common design scenarios',
    docs: [] as typeof allDocs,
  },
  guides: {
    label: 'Guides',
    description: 'Step-by-step implementation',
    docs: [] as typeof allDocs,
  },
};

// Badge variants per section
const sectionVariants: Record<string, 'default' | 'secondary' | 'muted' | 'accent'> = {
  concepts: 'default',
  tokens: 'accent',
  components: 'secondary',
  patterns: 'muted',
  guides: 'secondary',
};

for (const doc of allDocs) {
  const section = doc.data.section || 'concepts';
  if (sections[section]) {
    sections[section].docs.push(doc);
  }
}

// Sort each section by order
for (const section of Object.values(sections)) {
  section.docs.sort((a, b) => (a.data.order || 999) - (b.data.order || 999));
}

const sectionOrder = ['concepts', 'tokens', 'components', 'patterns', 'guides'] as const;

// Count total docs
const totalDocs = allDocs.length;
const sectionsWithDocs = sectionOrder.filter((key) => sections[key].docs.length > 0);
---

<BaseLayout title="Documentation" description="Rafters Design Intelligence Protocol documentation">
  <Container as="main" size="5xl" padding="6">
    {/* Header */}
    <header class="pb-8">
      <Muted class="mb-2">Design Intelligence Protocol</Muted>
      <H1 class="mb-4">Documentation</H1>
      <Lead class="max-w-2xl mb-6">
        Learn how Rafters encodes designer judgment into queryable data for AI agents.
      </Lead>
      
      {/* Stats */}
      <div class="flex gap-6">
        <div class="flex items-center gap-2">
          <span class="text-2xl font-semibold text-primary">{totalDocs}</span>
          <Muted>articles</Muted>
        </div>
        <div class="flex items-center gap-2">
          <span class="text-2xl font-semibold text-primary">{sectionsWithDocs.length}</span>
          <Muted>sections</Muted>
        </div>
      </div>
    </header>

    <Separator class="mb-12" />

    {/* Sections */}
    <div class="flex flex-col gap-16">
      {sectionOrder.map((key) => {
        const section = sections[key];
        if (section.docs.length === 0) return null;
        
        return (
          <section>
            <div class="mb-6 flex items-start justify-between">
              <div>
                <div class="flex items-center gap-3 mb-2">
                  <H2 class="m-0">{section.label}</H2>
                  <Badge variant={sectionVariants[key]} size="sm">
                    {section.docs.length}
                  </Badge>
                </div>
                <Muted>{section.description}</Muted>
              </div>
            </div>
            
            <Grid preset="linear" columns={section.docs.length === 1 ? 1 : 2} gap="4">
              {section.docs.map((doc) => (
                <a href={`/docs/${doc.slug}`} class="no-underline">
                  <Card interactive as="article" class="h-full">
                    <CardHeader>
                      <CardTitle as="h3" class="text-lg">
                        {doc.data.title}
                      </CardTitle>
                      <CardDescription>
                        {doc.data.description}
                      </CardDescription>
                    </CardHeader>
                  </Card>
                </a>
              ))}
            </Grid>
          </section>
        );
      })}
    </div>

    {/* Footer */}
    <Separator class="my-12" />
    <footer class="pb-8">
      <div class="flex items-center justify-between">
        <a 
          href="/" 
          class="inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors"
        >
          <svg class="w-4 h-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M19 12H5M12 19l-7-7 7-7" />
          </svg>
          Component Gallery
        </a>
        <Muted>Rafters Design Intelligence Protocol</Muted>
      </div>
    </footer>
  </Container>
</BaseLayout>
