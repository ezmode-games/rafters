---
/**
 * Dynamic Component Contact Sheet Page
 * Shows detailed view of a single component with live demos
 */

import ContactSheet from '../../components/contact-sheet/ContactSheet.astro';
import { ComponentDemo, getDemoTypes } from '../../components/demos/ComponentDemo';
import GalleryLayout from '../../layouts/GalleryLayout.astro';
import { getComponentNames, loadComponent } from '../../lib/component-registry';

// Generate static paths for all components
export function getStaticPaths() {
  const names = getComponentNames();
  return names.map((name) => ({
    params: { name },
  }));
}

const { name } = Astro.params;
const component = loadComponent(name);

if (!component) {
  return Astro.redirect('/404');
}

// Check which demo types are available
const demoTypes = getDemoTypes(name);
const hasVariants = demoTypes.includes('variants');
const hasSizes = demoTypes.includes('sizes');
---

<GalleryLayout
  title={component.displayName}
  description={`${component.displayName} - ${component.description || component.intelligence.cognitiveLoad.description}`}
>
  <div class="flex flex-col gap-6">
    <!-- Breadcrumb -->
    <nav class="flex items-center gap-2 font-mono text-xs tracking-wider uppercase" aria-label="Breadcrumb">
      <a href="/" class="text-muted-foreground no-underline hover:text-foreground transition-colors">
        Components
      </a>
      <span class="text-border" aria-hidden="true">/</span>
      <span class="text-primary">{component.displayName}</span>
    </nav>

    <!-- Contact Sheet with Live Demo -->
    <ContactSheet component={component} hasVariantsDemo={hasVariants} hasSizesDemo={hasSizes}>
      <div slot="demo">
        <ComponentDemo name={name} client:load />
      </div>
      {hasVariants && (
        <div slot="variants">
          <ComponentDemo name={name} type="variants" client:load />
        </div>
      )}
      {hasSizes && (
        <div slot="sizes">
          <ComponentDemo name={name} type="sizes" client:load />
        </div>
      )}
    </ContactSheet>

    <!-- Navigation -->
    <nav class="pt-6 border-t border-border" aria-label="Component navigation">
      <a
        href="/"
        class="inline-flex items-center gap-2 font-mono text-xs tracking-wider uppercase text-muted-foreground no-underline px-4 py-2 border border-border transition-colors hover:text-foreground hover:border-primary"
      >
        <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path d="M19 12H5M12 19l-7-7 7-7" />
        </svg>
        Back to Gallery
      </a>
    </nav>
  </div>
</GalleryLayout>
