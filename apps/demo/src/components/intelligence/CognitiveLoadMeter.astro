---
/**
 * CognitiveLoadMeter - Visual gauge for cognitive load score
 * Shows 1-10 scale with color-coded segments and zone labels
 */

interface Props {
  score: number;
  maxScore?: number;
  showLabels?: boolean;
  class?: string;
}

const { score, maxScore = 10, showLabels = true, class: className = '' } = Astro.props;

const segments = Array.from({ length: maxScore }, (_, i) => i + 1);

// Get segment styling based on score level
function getSegmentClass(segment: number): string {
  if (segment > score) return 'bg-muted/30';
  if (score <= 3) return 'bg-success';
  if (score <= 6) return 'bg-warning';
  return 'bg-destructive';
}

// Get zone for the score
function getZone(s: number): { label: string; colorClass: string } {
  if (s <= 3) return { label: 'Peripheral', colorClass: 'text-success border-success' };
  if (s <= 6) return { label: 'Focused', colorClass: 'text-warning border-warning' };
  return { label: 'Demanding', colorClass: 'text-destructive border-destructive' };
}

const zone = getZone(score);
---

<div class={`flex flex-col gap-2 ${className}`}>
  <div class="flex gap-0.5 h-6 bg-background p-1 border border-border" role="meter" aria-valuenow={score} aria-valuemin={1} aria-valuemax={maxScore}>
    {segments.map((segment) => (
      <div
        class={`flex-1 border border-border/50 transition-colors ${getSegmentClass(segment)}`}
        data-value={segment}
        aria-hidden="true"
      />
    ))}
  </div>

  {showLabels && (
    <div class="flex justify-between items-center">
      <div class="font-mono text-sm tracking-wide">
        <span class="text-foreground font-medium">{score}</span>
        <span class="text-border mx-0.5">/</span>
        <span class="text-muted-foreground">{maxScore}</span>
      </div>
      <div class={`font-mono text-xs tracking-widest uppercase px-2 py-0.5 border ${zone.colorClass}`}>
        {zone.label}
      </div>
    </div>
  )}

  <div class="flex justify-between" aria-hidden="true">
    <span class="font-mono text-xs tracking-wider uppercase text-success">Low</span>
    <span class="font-mono text-xs tracking-wider uppercase text-warning">Medium</span>
    <span class="font-mono text-xs tracking-wider uppercase text-destructive">High</span>
  </div>
</div>
