import { Meta, Canvas } from '@storybook/addon-docs/blocks';
import * as Stories from './MotionIntelligence.stories.tsx';

<Meta title="01 Foundation/Motion Intelligence" of={Stories} name="Overview" />

# Motion Intelligence

**Motion is the bridge between intention and understanding.** Every animation in Rafters carries embedded design intelligence to help AI agents make informed decisions about when, how, and why to use motion.

## Design Intelligence Principles

Motion in Rafters follows systematic intelligence patterns that AI agents can understand and apply:

### **Cognitive Load Awareness**
- **Load 1-2**: Instant feedback (hover, focus) - builds confidence
- **Load 3-5**: Standard transitions - maintains flow 
- **Load 6-8**: Deliberate attention - use sparingly
- **Load 9+**: Dramatic emphasis - high-stakes only

### **Trust Building Through Motion**
- **Immediate Response**: Hover states provide instant feedback
- **Natural Movement**: Smooth easing feels organic and trustworthy  
- **Predictable Behavior**: Consistent timing builds user confidence
- **Accessibility First**: Motion enhances, never replaces functionality

### **Attention Economics in Motion**
- **Single Focus**: Only one attention-drawing animation per viewport
- **Hierarchy Respect**: Motion supports content hierarchy, never competes
- **Progressive Disclosure**: Complex animations reveal information incrementally

## Motion Token System

### **Semantic Timing Tokens**
```tsx
import { timing, contextTiming } from '@rafters/design-tokens/motion'

// Base timing tokens with cognitive load ratings
timing.instant     // 75ms  - cognitiveLoad: 1, immediate feedback
timing.fast        // 150ms - cognitiveLoad: 2, interactive response  
timing.standard    // 300ms - cognitiveLoad: 3, balanced transitions
timing.deliberate  // 500ms - cognitiveLoad: 5, attention-drawing
timing.slow        // 700ms - cognitiveLoad: 7, graceful changes
timing.dramatic    // 1000ms- cognitiveLoad: 9, high-stakes emphasis

// Context-specific timing for AI decision-making
contextTiming.hover      // For all hover states - builds confidence
contextTiming.modal      // For overlays and dialogs - manages cognitive load
contextTiming.progress   // For loading states - builds trust during waits
contextTiming.toast      // For notifications - gentle, non-intrusive
```

### **Semantic Easing Tokens**
```tsx
import { easing, contextEasing } from '@rafters/design-tokens/motion'

// Base easing tokens with personality intelligence
easing.linear        // Mechanical, steady progress
easing.smooth        // Natural, organic movement (default choice)
easing.accelerating  // Welcoming appearance, growing confidence
easing.decelerating  // Graceful exit, maintains trust
easing.bouncy        // Playful celebration, positive reinforcement
easing.snappy        // Sharp feedback, immediate response

// Context-specific easing for informed UX decisions
contextEasing.hover       // Snappy response for interactivity
contextEasing.modalEnter  // Welcoming appearance reduces anxiety
contextEasing.modalExit   // Graceful departure maintains trust
contextEasing.success     // Celebratory bounce reinforces positive feedback
```

## AI Agent Decision Framework

### **Motion Selection Process**
When AI agents need to choose motion for a component:

1. **Assess Interaction Consequence**
   - High: Destructive actions, permanent changes → deliberate timing
   - Medium: Form submissions, state changes → standard timing
   - Low: Navigation, viewing content → fast timing

2. **Consider User Context**
   - First-time users → Slower, more deliberate motion
   - Expert users → Faster, more efficient motion
   - Accessibility needs → Reduced motion alternatives

3. **Apply Motion Intelligence**
   - Check cognitive load rating against user attention capacity
   - Ensure motion supports rather than competes with content
   - Verify accessibility compliance with automatic fallbacks

### **Component Motion Patterns**

**Interactive Elements (Button, Input, Select)**
```tsx
// Immediate feedback pattern
className={cn(
  'transition-all', 
  contextTiming.hover,    // 75ms
  contextEasing.hover,    // snappy
  'hover:opacity-hover active:scale-active'
)}
```

**Modal Elements (Dialog, Toast, Dropdown)**
```tsx
// Welcoming appearance pattern
className={cn(
  'transition-all',
  contextTiming.modal,      // 300ms
  contextEasing.modalEnter, // accelerating
  'opacity-0 scale-95 data-[state=open]:opacity-100 data-[state=open]:scale-100'
)}
```

**Progress Elements (Loading, Progress Bar)**
```tsx
// Trust-building progress pattern  
className={cn(
  'transition-all',
  contextTiming.progress, // 500ms
  contextEasing.progress, // linear
  'transform-gpu'
)}
```

## Accessibility Integration

**WCAG 2.1 Level AA/AAA Compliant Motion System**

All motion tokens include automatic `prefers-reduced-motion` support with accessibility-first design:

```css
/* Accessibility-compliant motion tokens */
.duration-75 {
  transition-duration: 75ms;
}

@media (prefers-reduced-motion: reduce) {
  .duration-75 {
    transition-duration: 0ms; /* 0ms for true instant transitions */
  }
}

.duration-150 {
  transition-duration: 150ms;
}

@media (prefers-reduced-motion: reduce) {
  .duration-150 {
    transition-duration: 0ms; /* No 1-10ms durations to prevent flash effects */
  }
}
```

### **Critical Accessibility Features**

**Vestibular Disorder Protection:**
- **0ms durations** in reduced-motion mode prevent flash effects that trigger vestibular symptoms
- **No 1-10ms durations** which can cause problematic micro-flashes
- **Spring/bounce animations** automatically replaced with linear easing in reduced-motion mode

**Focus Management:**
```tsx
// Focus indicators appear instantly (never animated)
'focus-visible:ring-2 focus-visible:ring-offset-2 focus-visible:duration-0'
```

**Cognitive Load Intelligence:**
- **Load 8+**: Motion automatically disabled regardless of user preference
- **Load 6-7**: Motion reduced to minimal durations in all modes
- **Critical actions**: Use deliberate timing to ensure user comprehension

**Screen Reader Compatibility:**
```tsx
import { announceMotionChange } from '../lib/motion-accessibility'

// Announce visual changes to screen readers
announceMotionChange('Modal opened', 'polite')
```

### **Advanced Accessibility Utilities**

```tsx
import { useAccessibleMotion } from '../lib/motion-accessibility'

const Component = () => {
  const {
    motionLevel,        // 'full' | 'reduced' | 'none'
    getMotionClass,     // Returns appropriate duration class
    shouldAnimate       // Boolean for conditional animations
  } = useAccessibleMotion({
    cognitiveLoad: 7,
    trustLevel: 'critical',
    interactionType: 'essential'
  })
  
  return (
    <div className={cn(
      'transition-all',
      getMotionClass('standard'), // Automatically adapts to accessibility needs
      'hover:opacity-hover'
    )}>
      Content
    </div>
  )
}
```

### **Motion Accessibility Principles**

**WCAG Compliance Standards:**
- ✅ **2.3.1** Three Flashes: No element flashes more than 3 times per second
- ✅ **2.3.3** Animation from Interactions: Motion can be disabled by user preference
- ✅ **2.2.2** Pause, Stop, Hide: Continuous animations respect user controls
- ✅ **2.4.7** Focus Visible: Focus indicators appear instantly without motion

**EAA (European Accessibility Act) Requirements:**
- Motion control available at system level
- Alternative non-motion interfaces for all interactions
- Clear documentation of motion accessibility features

**Section 508 Federal Compliance:**
- User control to disable all animations (not just reduce)
- VPAT documentation for motion control capabilities
- Assistive technology compatibility testing

### **Accessibility Testing Integration**

```tsx
// Automated accessibility testing
describe('Motion Accessibility', () => {
  test('respects prefers-reduced-motion', () => {
    // Test component with reduced motion enabled
    render(<Component />)
    expect(element).toHaveClass('motion-reduce:duration-0')
  })
  
  test('focus indicators appear instantly', () => {
    const { getByRole } = render(<Button>Test</Button>)
    const button = getByRole('button')
    button.focus()
    expect(button).toHaveClass('focus-visible:duration-0')
  })
})
```

## Component Integration Examples

### **Button with Motion Intelligence**
```tsx
import { contextTiming, contextEasing } from '@rafters/design-tokens/motion'

const Button = () => (
  <button className={cn(
    // Base interactive motion
    'transition-all',
    contextTiming.hover,
    contextEasing.hover,
    
    // State-specific motion
    'hover:opacity-hover',
    'active:scale-active',
    'focus-visible:ring-2',
    
    // Loading state motion
    'disabled:opacity-disabled',
    loading && cn(
      'cursor-wait',
      contextTiming.progress,
      contextEasing.loading
    )
  )}>
    {children}
  </button>
)
```

### **Modal with Motion Intelligence**
```tsx
const Dialog = () => (
  <div className={cn(
    // Entry animation
    'transition-all',
    contextTiming.modal,
    contextEasing.modalEnter,
    
    // Transform states
    'opacity-0 scale-95',
    'data-[state=open]:opacity-100',
    'data-[state=open]:scale-100',
    
    // Exit animation (handled by state change)
    'data-[state=closed]:opacity-0',
    'data-[state=closed]:scale-95'
  )}>
    {children}
  </div>
)
```

## Motion Testing and Validation

**AI Agent Checklist for Motion Decisions:**
- ✅ Motion timing matches component cognitive load rating
- ✅ Animation supports content hierarchy (doesn't compete)  
- ✅ Accessibility requirements met with automatic fallbacks
- ✅ Motion personality consistent with component trust level
- ✅ Interactive elements provide immediate feedback
- ✅ Loading states communicate progress clearly
- ✅ Maximum one attention-drawing animation per viewport

This motion intelligence system enables AI agents to create consistent, accessible, and trustworthy user experiences through systematic design decisions rather than guesswork.